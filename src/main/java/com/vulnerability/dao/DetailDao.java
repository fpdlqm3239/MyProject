package com.vulnerability.dao;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.sql.DataSource;

import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.jdbc.core.namedparam.SqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;
import org.springframework.stereotype.Repository;
import com.vulnerability.dao.DetailDaoSql;

import com.vulnerability.dto.Detail;

@Repository

public class DetailDao {
	private NamedParameterJdbcTemplate jdbc;
	private SimpleJdbcInsert insert;
	private RowMapper<Detail> rowmapper;
	
	
	DetailDao(DataSource dataSource){
		this.jdbc = new NamedParameterJdbcTemplate(dataSource);
		this.insert = new SimpleJdbcInsert(dataSource).usingGeneratedKeyColumns("id").withTableName("detail");
		this.rowmapper = BeanPropertyRowMapper.newInstance(Detail.class); 
	}
	
	
	public List<Detail> selectDetailByResultIdAndCategory(int resultId, String category){
		Map<String, Object> params = new HashMap<String, Object>();
		params.put("resultId", resultId);
		params.put("category", category);
		List<Detail> list = jdbc.query(DetailDaoSql.SELECT_BY_RESULT_ID_AND_CATEGORY  , params, rowmapper);
		return list;
	}
	
	public void insertDetail(Detail detail) {
		SqlParameterSource params = new BeanPropertySqlParameterSource(detail);
		insert.execute(params);
	}
	
}
